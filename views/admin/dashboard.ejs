<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Shipments Dashboard</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
      body {
        font-family: Arial, Helvetica, sans-serif;
        background: #f7f7fb;
        padding: 20px;
      }
      .container {
        max-width: 1200px;
        margin: 0 auto;
      }
      table {
        width: 100%;
        border-collapse: collapse;
        background: #fff;
        border-radius: 8px;
        overflow: hidden;
      }
      th,
      td {
        padding: 12px;
        border-bottom: 1px solid #eee;
      }
      th {
        background: #667eea;
        color: #fff;
        text-align: left;
      }
      tr:hover {
        background: #f2f6ff;
      }
      .actions a,
      .actions form {
        display: inline-block;
        margin-right: 6px;
      }
      .btn {
        padding: 8px 12px;
        border-radius: 6px;
        text-decoration: none;
        color: #fff;
      }
      .btn.green {
        background: #28a745;
      }
      .btn.orange {
        background: #ff8c00;
      }
      .btn.red {
        background: #dc3545;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <% include('../partials/header') %>
      <h1>Shipments</h1>
      <p>
        <a class="btn green" href="/shipment/new"
          ><i class="fas fa-plus"></i> New Shipment</a
        >
      </p>

      <table>
        <thead>
          <tr>
            <th>Tracking</th>
            <th>Sender → Receiver</th>
            <th>Route</th>
            <th>Created</th>
            <th>Latest Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <% shipments.forEach(s => { %>
          <tr>
            <td>
              <a href="/shipment/<%= s._id %>"
                ><strong><%= s.trackingNumber %></strong></a
              >
            </td>
            <td><%= s.shipperName || '—' %> → <%= s.receiverName || '—' %></td>
            <td><%= s.destination || '—' %></td>
            <td><%= new Date(s.createdAt).toLocaleString() %></td>
            <td>
              <% if (s.statusHistory && s.statusHistory.length) { %>
              <span
                style="
                  background: #e9ecef;
                  padding: 6px 10px;
                  border-radius: 20px;
                "
                ><%= s.statusHistory[s.statusHistory.length-1].theStatus
                %></span
              >
              <% } else { %>
              <span style="color: #888">No updates</span>
              <% } %>
            </td>
            <td class="actions">
              <a
                class="btn"
                style="background: #0d6efd"
                href="/shipment/<%= s._id %>"
                ><i class="fas fa-eye"></i
              ></a>
              <a class="btn orange" href="/shipment/<%= s._id %>/edit"
                ><i class="fas fa-pen"></i
              ></a>
              <form
                action="/shipment/<%= s._id %>?_method=DELETE"
                method="POST"
                onsubmit="return confirm('Delete shipment?');"
                style="display: inline"
              >
                <button class="btn red" type="submit">
                  <i class="fas fa-trash"></i>
                </button>
              </form>
            </td>
          </tr>
          <% }) %>
        </tbody>
      </table>
    </div>
  </body>
</html>
